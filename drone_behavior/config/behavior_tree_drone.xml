<?xml version="1.0" encoding="UTF-8"?>
<root BTCPP_format="4">
  <BehaviorTree ID="root_drone">
    <Sequence>
      <Script name="TAKE_OFF_SCRIPT"
              code="State:=TAKING_OFF"/>
      <GoToPose name="TAKE OFF"
                Target="0;0;1.0;0"
                State_Type="{State}"/>
      <Repeat num_cycles="5">
        <ReactiveSequence>
          <Script code="State:=AUTOMATIC"/>
          <ReactiveFallback>
            <Sequence>
              <Inverter>
                <CheckBattery Battery_Threshold="40"
                              battery_level="{battery_level}"/>
              </Inverter>
              <Script code="State:=LANDING"/>
              <GoToPose name="ChargePoint"
                        Target="-1;0;0.55;0"
                        State_Type="{State}"/>
              <Sleep msec="5000"/>
              <SetBlackboard value="100.0"
                             output_key="battery_level"/>
            </Sequence>
            <Sequence>
              <Sequence name="Station A">
                <GoToPose Target="5;0;1.0;0"
                          State_Type="{State}"/>
                <GoToPose name="PointA"
                          Target="5;0;0.55;0"
                          State_Type="{State}"/>
                <Sleep msec="1000"/>
              </Sequence>
              <Sequence name="Station B">
                <GoToPose Target="5;5;1.0;0"
                          State_Type="{State}"/>
                <GoToPose name="PointB"
                          Target="5;5;0.55;0"
                          State_Type="{State}"/>
                <Sleep msec="1000"/>
              </Sequence>
              <Sequence name="Station C">
                <GoToPose Target="0;5;1.0;0"
                          State_Type="{State}"/>
                <GoToPose name="PointC"
                          Target="0;5;0.55;0"
                          State_Type="{State}"/>
                <Sleep msec="1000"/>
              </Sequence>
            </Sequence>
          </ReactiveFallback>
        </ReactiveSequence>
      </Repeat>
      <Script code="State:=LANDING"/>
      <GoToPose name="LANDING_POS"
                Target="0;0;0;0"
                State_Type="{State}"/>
    </Sequence>
  </BehaviorTree>

  <!-- Description of Node Models (used by Groot) -->
  <TreeNodesModel>
    <Condition ID="CheckBattery"
               editable="true">
      <input_port name="Battery_Threshold"
                  default="40"/>
      <output_port name="battery_level"/>
    </Condition>
    <Action ID="GoToPose"
            editable="true">
      <input_port name="Target">Target Position In Format x;y;z;yaw</input_port>
      <input_port name="State_Type"/>
    </Action>
  </TreeNodesModel>

</root>
