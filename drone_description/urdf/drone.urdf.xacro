<?xml version="1.0"?>
<robot xmlns:xacro="http://www.ros.org/wiki/xacro" name="drone">

    <xacro:property name="robot_name" value="drone" />



    <!-- MATERIAL COLOR  -->
    <material name="red">
        <color rgba="0.8 0 0 1"/>
    </material>
    <material name="black">
        <color rgba="0 0 0 1"/>
    </material>

    <link name="drone/base_footprint"/>



    <link name="drone/chassis_link">
        <pose>0 0 0.2 0 0 0</pose>
        <inertial>
            <mass value="1.5"/>
            <inertia ixx="0.0347563" ixy="0" ixz="0" iyy="0.07" iyz="0" izz="0.0977"/>
        </inertial>

        <collision>
            <origin xyz="0 0 0" rpy="0 0 0"/>
            <geometry>
                <mesh filename="file://$(find drone_description)/meshes/base_link.dae" scale="5 5 5"/>
            </geometry>
        </collision>

        <visual>
            <origin xyz="0 0 0" rpy="0 0 0"/>
            <geometry>
                <mesh filename="file://$(find drone_description)/meshes/base_link.dae" scale="5 5 5"/>
            </geometry>
            <material name="red"/>

        </visual>
    </link>

    <joint name="drone/base_joint" type="fixed">
        <parent link="drone/base_footprint"/>
        <child link="drone/chassis_link"/>
        <origin xyz="0.0 0.0 0.1460" rpy="0.0 0.0 0.0"/>
    </joint>



    <link name="drone/m1_link">
        <pose>0.19 -0.19 -0.025 0 0 0</pose>
        <inertial>
            <mass value="0.005"/>
            <inertia ixx="9.75e-07" ixy="0" ixz="0" iyy="4.17041e-05" iyz="0" izz="4.26041e-05"/>
        </inertial>

        <collision>
            <origin xyz="0 0 0" rpy="0 0 0"/>
            <geometry>
                <mesh filename="file://$(find drone_description)/meshes/m1_link.dae" scale="5 5 5"/>
            </geometry>
        </collision>

        <visual>
            <origin xyz="0 0 0" rpy="0 0 0"/>
            <geometry>
                <mesh filename="file://$(find drone_description)/meshes/m1_link.dae" scale="5 5 5"/>
            </geometry>
            <material name="black"/>
        </visual>
    </link>


    <joint name="drone/m1_joint" type="revolute">
        <parent link="drone/chassis_link"/>
        <child link="drone/m1_link"/>
        <origin xyz="0.19 -0.19 -0.025" rpy="0 0 0"/>
        <axis xyz="0 0 1"/>
        <limit lower="-1e+16" upper="1e+16" effort="10.0" velocity="1000.0"/>

    </joint>


    <link name="drone/m2_link">
        <pose>-0.19 0.19 -0.025 0 0 0</pose>
        <inertial>
            <mass value="0.005"/>
            <inertia ixx="9.75e-07" ixy="0" ixz="0" iyy="4.17041e-05" iyz="0" izz="4.26041e-05"/>
        </inertial>

        <collision>
            <origin xyz="0 0 0" rpy="0 0 0"/>
            <geometry>
                <mesh filename="file://$(find drone_description)/meshes/m2_link.dae" scale="5 5 5"/>
            </geometry>
        </collision>

        <visual>
            <origin xyz="0 0 0" rpy="0 0 0"/>
            <geometry>
                <mesh filename="file://$(find drone_description)/meshes/m2_link.dae" scale="5 5 5"/>
            </geometry>
            <material name="black"/>

        </visual>
    </link>


    <joint name="drone/m2_joint" type="revolute">
        <parent link="drone/chassis_link"/>
        <child link="drone/m2_link"/>
        <origin xyz="-0.19 0.19 -0.025" rpy="0 0 0"/>
        <axis xyz="0 0 1"/>
        <limit lower="-1e+16" upper="1e+16" effort="10.0" velocity="1000.0"/>

    </joint>



    <link name="drone/m3_link">
        <pose>0.19 0.19 -0.025 0 0 0</pose>
        <inertial>
            <mass value="0.005"/>
            <inertia ixx="9.75e-07" ixy="0" ixz="0" iyy="4.17041e-05" iyz="0" izz="4.26041e-05"/>
        </inertial>

        <collision>
            <origin xyz="0 0 0" rpy="0 0 0"/>
            <geometry>
                <mesh filename="file://$(find drone_description)/meshes/m3_link.dae" scale="5 5 5"/>
            </geometry>
        </collision>

        <visual>
            <origin xyz="0 0 0" rpy="0 0 0"/>
            <geometry>
                <mesh filename="file://$(find drone_description)/meshes/m3_link.dae" scale="5 5 5"/>
            </geometry>
            <material name="black"/>

        </visual>
    </link>


    <joint name="drone/m3_joint" type="revolute">
        <parent link="drone/chassis_link"/>
        <child link="drone/m3_link"/>
        <origin xyz="0.19 0.19 -0.025" rpy="0 0 0"/>
        <axis xyz="0 0 1"/>
        <limit lower="-1e+16" upper="1e+16" effort="10.0" velocity="1000.0"/>

    </joint>



    <link name="drone/m4_link">
        <pose>-0.19 -0.19 -0.025 0 0 0</pose>
        <inertial>
            <mass value="0.005"/>
            <inertia ixx="9.75e-07" ixy="0" ixz="0" iyy="4.17041e-05" iyz="0" izz="4.26041e-05"/>
        </inertial>

        <collision>
            <origin xyz="0 0 0" rpy="0 0 0"/>
            <geometry>
                <mesh filename="file://$(find drone_description)/meshes/m4_link.dae" scale="5 5 5"/>
            </geometry>
        </collision>

        <visual>
            <origin xyz="0 0 0" rpy="0 0 0"/>
            <geometry>
                <mesh filename="file://$(find drone_description)/meshes/m4_link.dae" scale="5 5 5"/>
            </geometry>
            <material name="black"/>
        </visual>
    </link>


    <joint name="drone/m4_joint" type="revolute">
        <parent link="drone/chassis_link"/>
        <child link="drone/m4_link"/>
        <origin xyz="-0.19 -0.19 -0.025" rpy="0 0 0"/>
        <axis xyz="0 0 1"/>
        <limit lower="-1e+16" upper="1e+16" effort="10.0" velocity="1000.0"/>

    </joint>




    <gazebo>
        <plugin filename="ignition-gazebo-multicopter-motor-model-system" name="gz::sim::systems::MulticopterMotorModel">
            <jointName>drone/m1_joint</jointName>
            <linkName>drone/m1_link</linkName>
            <turningDirection>ccw</turningDirection>
            <timeConstantUp>0.0125</timeConstantUp>
            <timeConstantDown>0.025</timeConstantDown>
            <maxRotVelocity>800.0</maxRotVelocity>
            <motorConstant>8.54858e-06</motorConstant>
            <momentConstant>0.016</momentConstant>
            <commandSubTopic>gazebo/command/motor_speed</commandSubTopic>
            <motorNumber>0</motorNumber>
            <rotorDragCoefficient>8.06428e-05</rotorDragCoefficient>
            <rollingMomentCoefficient>1e-06</rollingMomentCoefficient>
            <motorSpeedPubTopic>motor_speed/0</motorSpeedPubTopic>
            <rotorVelocitySlowdownSim>10</rotorVelocitySlowdownSim>
            <motorType>velocity</motorType>
        </plugin>

        <plugin filename="ignition-gazebo-multicopter-motor-model-system" name="gz::sim::systems::MulticopterMotorModel">

            <robotNamespace>${robot_name}</robotNamespace>
            <jointName>drone/m2_joint</jointName>
            <linkName>drone/m2_link</linkName>
            <turningDirection>ccw</turningDirection>
            <timeConstantUp>0.0125</timeConstantUp>
            <timeConstantDown>0.025</timeConstantDown>
            <maxRotVelocity>800.0</maxRotVelocity>
            <motorConstant>8.54858e-06</motorConstant>
            <momentConstant>0.016</momentConstant>
            <commandSubTopic>gazebo/command/motor_speed</commandSubTopic>
            <motorNumber>1</motorNumber>
            <rotorDragCoefficient>8.06428e-05</rotorDragCoefficient>
            <rollingMomentCoefficient>1e-06</rollingMomentCoefficient>
            <motorSpeedPubTopic>motor_speed/0</motorSpeedPubTopic>
            <rotorVelocitySlowdownSim>10</rotorVelocitySlowdownSim>
            <motorType>velocity</motorType>
        </plugin>


        <plugin filename="ignition-gazebo-multicopter-motor-model-system" name="gz::sim::systems::MulticopterMotorModel">
            <robotNamespace>${robot_name}</robotNamespace>
            <jointName>drone/m3_joint</jointName>
            <linkName>drone/m3_link</linkName>
            <turningDirection>cw</turningDirection>
            <timeConstantUp>0.0125</timeConstantUp>
            <timeConstantDown>0.025</timeConstantDown>
            <maxRotVelocity>800.0</maxRotVelocity>
            <motorConstant>8.54858e-06</motorConstant>
            <momentConstant>0.016</momentConstant>
            <commandSubTopic>gazebo/command/motor_speed</commandSubTopic>
            <motorNumber>2</motorNumber>
            <rotorDragCoefficient>8.06428e-05</rotorDragCoefficient>
            <rollingMomentCoefficient>1e-06</rollingMomentCoefficient>
            <motorSpeedPubTopic>motor_speed/0</motorSpeedPubTopic>
            <rotorVelocitySlowdownSim>10</rotorVelocitySlowdownSim>
            <motorType>velocity</motorType>
        </plugin>


        <plugin filename="ignition-gazebo-multicopter-motor-model-system" name="gz::sim::systems::MulticopterMotorModel">
            <robotNamespace>${robot_name}</robotNamespace>
            <jointName>drone/m4_joint</jointName>
            <linkName>drone/m4_link</linkName>
            <turningDirection>cw</turningDirection>
            <timeConstantUp>0.0125</timeConstantUp>
            <timeConstantDown>0.025</timeConstantDown>
            <maxRotVelocity>800.0</maxRotVelocity>
            <motorConstant>8.54858e-06</motorConstant>
            <momentConstant>0.016</momentConstant>
            <commandSubTopic>gazebo/command/motor_speed</commandSubTopic>
            <motorNumber>3</motorNumber>
            <rotorDragCoefficient>8.06428e-05</rotorDragCoefficient>
            <rollingMomentCoefficient>1e-06</rollingMomentCoefficient>
            <motorSpeedPubTopic>motor_speed/0</motorSpeedPubTopic>
            <rotorVelocitySlowdownSim>10</rotorVelocitySlowdownSim>
            <motorType>velocity</motorType>
        </plugin>


        <plugin filename="ignition-gazebo-multicopter-control-system" name="ignition::gazebo::systems::MulticopterVelocityControl">
            <robotNamespace>${robot_name}</robotNamespace>
            <commandSubTopic>cmd_vel</commandSubTopic>
            <enableSubTopic>enable</enableSubTopic>
            <comLinkName>drone/base_footprint</comLinkName>
            <velocityGain>2.7 2.7 2.7</velocityGain>
            <attitudeGain>2 3 0.15</attitudeGain>
            <angularRateGain>0.4 0.52 0.18</angularRateGain>
            <maximumLinearAcceleration>2 2 2</maximumLinearAcceleration>

            <rotorConfiguration>
                <rotor>
                    <jointName>drone/m1_joint</jointName>
                    <forceConstant>8.54858e-06</forceConstant>
                    <momentConstant>0.016</momentConstant>
                    <direction>1</direction>
                </rotor>
                <rotor>
                    <jointName>drone/m2_joint</jointName>
                    <forceConstant>8.54858e-06</forceConstant>
                    <momentConstant>0.016</momentConstant>
                    <direction>1</direction>
                </rotor>
                <rotor>
                    <jointName>drone/m3_joint</jointName>
                    <forceConstant>8.54858e-06</forceConstant>
                    <momentConstant>0.016</momentConstant>
                    <direction>-1</direction>
                </rotor>
                <rotor>
                    <jointName>drone/m4_joint</jointName>
                    <forceConstant>8.54858e-06</forceConstant>
                    <momentConstant>0.016</momentConstant>
                    <direction>-1</direction>
                </rotor>
            </rotorConfiguration>
        </plugin>


        <plugin filename="ignition-gazebo-joint-state-publisher-system" name="ignition::gazebo::systems::JointStatePublisher">
            <joint_name>drone/m1_joint</joint_name>
            <joint_name>drone/m2_joint</joint_name>
            <joint_name>drone/m3_joint</joint_name>
            <joint_name>drone/m4_joint</joint_name>
        </plugin>

        <plugin filename="gz-sim-odometry-publisher-system" name="ignition::gazebo::systems::OdometryPublisher">
            <dimensions>3</dimensions>
            <odom_frame>drone/odom</odom_frame>
            <robot_base_frame>drone/base_footprint</robot_base_frame>
        </plugin>

    </gazebo>


    <!-- Color Tag -->
    <gazebo reference="drone/chassis_link">
        <visual>
            <material>
                <ambient>0.8 0 0 1</ambient>
                <diffuse>0.8 0 0 1</diffuse>
                <specular>0.8 0 0 1</specular>
            </material>
        </visual>
    </gazebo>


    <gazebo reference="drone/m1_link">
        <visual>
            <material>
                <ambient>0 0 0 1</ambient>
                <diffuse>0 0 0 1</diffuse>
                <specular>0 0 0 1</specular>
            </material>
        </visual>
    </gazebo>

    <gazebo reference="drone/m2_link">
        <visual>
            <material>
                <ambient>0 0 0 1</ambient>
                <diffuse>0 0 0 1</diffuse>
                <specular>0 0 0 1</specular>
            </material>
        </visual>
    </gazebo>

    <gazebo reference="drone/m3_link">
        <visual>
            <material>
                <ambient>0 0 0 1</ambient>
                <diffuse>0 0 0 1</diffuse>
                <specular>0 0 0 1</specular>
            </material>
        </visual>
    </gazebo>

    <gazebo reference="drone/m4_link">
        <visual>
            <material>
                <ambient>0 0 0 1</ambient>
                <diffuse>0 0 0 1</diffuse>
                <specular>0 0 0 1</specular>
            </material>
        </visual>
    </gazebo>





</robot>
